(this["webpackJsonpimage-editor"]=this["webpackJsonpimage-editor"]||[]).push([[18],{1260:function(e,t,c){},1261:function(e,t,c){},1309:function(e,t,c){"use strict";function n(){function e(e,t){var c=Object.keys(K),n=T.filter((function(e){return!c.includes("".concat(e.id))})).map((function(e){return e.id})),a=T.reduce((function(t,c){return t[c.id]=e,t}),{});M(a),"cancel"===t?window._stat_track("hb_record_subfunction_click",{"\u5206\u7c7b":"\u9000\u51fa"}):"all"===t&&(e?window._stat_track("hb_record_subfunction_click",{"\u5206\u7c7b":"\u5168\u9009","\u6a21\u677f":n.join(",")}):(M({}),window._stat_track("hb_record_subfunction_click",{"\u5206\u7c7b":"\u5168\u90e8\u53bb\u9009"})))}var t=Object(r.useState)(!1),c=(t=Object(a.a)(t,2))[0],n=t[1],i=(t=Object(r.useState)(!1),(t=Object(a.a)(t,2))[0]),s=t[1],d=(t=Object(r.useState)(""),(t=Object(a.a)(t,2))[0]),u=t[1],T=(t=Object(r.useState)([]),(t=Object(a.a)(t,2))[0]),D=t[1],K=(t=Object(r.useState)({}),(t=Object(a.a)(t,2))[0]),M=t[1],q=Object(v.a)().recordInfo,P=Object(v.c)(),A=Object(g.d)(),F=Object(y.a)(),J=Object(I.E)(),L=Object(E.b)((function(e){return e.stageModel})).setEnterType,z=(t=(0,Object(w.b)().showUserInfo)(),function(){var e=Object(O.a)(Object(f.a)().mark((function e(t,a){var r,o,_;return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t||!c&&i){e.next=2;break}return e.abrupt("return");case 2:return n(!0),e.next=5,Object(k.d)({cursor:t?"":d,type:"1"});case 5:r=e.sent,n(!1),r.data.error_code===p.a.OK&&(_=(null==(_=r.data)||null==(_=_.data)?void 0:_.lists)||[],s(!(null==(o=r.data.data)||!o.cursor)),u((null==(o=r.data.data)?void 0:o.cursor)||""),Y(t?_:T.concat(_))),t||window._stat_track("hb_updown",{"\u5206\u7c7b":"\u4e0a\u6ed1\u52a0\u8f7d","\u6765\u6e90":"\u4f5c\u56fe\u8bb0\u5f55\u9875",is_search:1});case 9:case"end":return e.stop()}}),e)})));return function(t,c){return e.apply(this,arguments)}}()),H=function(){var e=Object(O.a)(Object(f.a)().mark((function e(){var t,c,n;return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(k.d)({cursor:"",type:"1"});case 2:(c=e.sent).data.error_code===p.a.OK&&(c=(null==(c=c.data.data)?void 0:c.lists)||[],t=c[0]||{},c=Object(j.a)(T),-1<(n=c.findIndex((function(e){return e.id===t.id})))?c.splice(n,1,t):c.unshift(t),Y(c));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(O.a)(Object(f.a)().mark((function e(){return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window._stat_track("hb_delete_backwindow_show",{"\u6765\u6e90":"\u4f5c\u56fe\u8bb0\u5f55"}),h.j.confirm({title:"\u5220\u9664\u63d0\u793a",content:"\u5220\u9664\u4f5c\u56fe\u8bb0\u5f55\u540e\u5c06\u65e0\u6cd5\u91cd\u65b0\u627e\u56de\uff0c\u8bf7\u8c28\u614e\u64cd\u4f5c\uff01",okText:"\u786e\u8ba4\u5220\u9664",cancelText:"\u53d6\u6d88",centered:!0,closable:!0,onOk:function(){var e=Object(O.a)(Object(f.a)().mark((function e(){var t,c,n;return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Object.keys(K).filter((function(e){return K[+e]})),e.next=4,Object(k.b)({id:t.join(",")});case 4:if(e.sent.data.error_code===p.a.OK)return e.next=8,Object(k.d)({cursor:"",type:"1"});e.next=12;break;case 8:(t=e.sent).data.error_code===p.a.OK&&(n=(null==(n=t.data.data)?void 0:n.lists)||[],s(!(null==(c=t.data.data)||!c.cursor)),u((null==(c=t.data.data)?void 0:c.cursor)||""),Y(n)),M({}),h.i.success("\u5220\u9664\u6210\u529f");case 12:window._stat_track("hb_record_subfunction_click",{"\u5206\u7c7b":"\u5220\u9664"}),window._stat_track("hb_delete_backwindow_click",{"\u6765\u6e90":"\u4f5c\u56fe\u8bb0\u5f55","\u5206\u7c7b":"\u5220\u9664"}),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0);case 19:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(){return e.apply(this,arguments)}}(),onCancel:function(){window._stat_track("hb_delete_backwindow_click",{"\u6765\u6e90":"\u4f5c\u56fe\u8bb0\u5f55","\u5206\u7c7b":"\u53d6\u6d88"})}});case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=Object(O.a)(Object(f.a)().mark((function e(t){var c,n;return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=t.id,window._stat_track("tpbj_subfunction_click",{func:"16_71",click_type:0,open:1,record_id:q.id||""}),n=function(){var e=Object(O.a)(Object(f.a)().mark((function e(){var t,n,a,r,i,s;return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A.show(),L("record"),e.next=4,Object(k.e)({id:"".concat(c)});case 4:if(r=(r=e.sent).data.data,i=r.records,t=r.editor_version,n=r.original_image,a=r.caption,r=JSON.parse(i||"[]"),Object(N.b)(),0<r.length)return i="",n&&(i=n.match(/[^\.]\w*$/)[0]),e.next=13,F.initLayers(r,{naturalFileName:a||"",naturalImage:n||"",naturalFileSize:0,naturalFileSuffix:i||""},t);e.next=16;break;case 13:P(Object(b.a)(Object(b.a)({},q),{},{id:c})),e.next=21;break;case 16:h.i.warn("\u5f53\u524d\u4f5c\u56fe\u8bb0\u5f55\u56e0\u5386\u53f2\u539f\u56e0\uff0c\u65e0\u6cd5\u6b63\u5e38\u52a0\u8f7d\uff0c\u53ea\u80fd\u4f5c\u4e3a\u56fe\u7247\u4f7f\u7528\u3002"),(s=new Image).crossOrigin="",s.onload=function(){var e=Object(C.a)(s);F.createImg({imgSrc:e,width:0,height:0,name:a})},s.src=n;case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),0===J.length)return n(),e.abrupt("return");e.next=7;break;case 7:h.j.confirm({title:"\u63d0\u793a",content:"\u662f\u5426\u786e\u8ba4\u5207\u6362\u753b\u5e03",okText:"\u786e\u8ba4",cancelText:"\u53d6\u6d88",centered:!0,closable:!0,onOk:function(){var e=Object(O.a)(Object(f.a)().mark((function e(){return Object(f.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:window._stat_track("tpbj_subfunction_tick",{func:"16_71",record_id:q.id||""}),n();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),onCancel:function(){}});case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Y=(Object(r.useEffect)((function(){D([]),z(!0)}),[t]),Object(r.useEffect)((function(){!q.isRecording&&T.length&&H()}),[q.isRecording]),function(e){e=e.map((function(e,t){return Object(b.a)(Object(b.a)({},e),{},{trackIndex:t})})),D(e)});Object(x.a)("mine-record-track",T,(function(e){var t=e.id,c=(e=e.index,o.a.parse(window.location.search));t={"\u6a21\u677fid":t,"\u4f4d\u7f6e":e,"\u6765\u6e90":"\u4f5c\u56fe\u8bb0\u5f55\u9875",entry:c.from||"other"};c.query&&(t.query=c.query),c.scm&&(t.scm=c.scm),c.class&&(t.class=c.class),c.scene_id&&(t.scene_id=c.scene_id),c.collection_id&&(t.collection_id=c.collection_id),(q.topic_id||c.id)&&(t["\u4e13\u9898ID"]=q.topic_id||c.id),(q.category_id||c.categoryId)&&(t["\u5206\u7c7bID"]=q.category_id||c.categoryId),window._stat_track("hb_template_show",t)})),t=Object.values(K).filter((function(e){return e})).length;return Object(S.jsxs)("div",{className:"mine-record",children:[t?Object(S.jsx)("div",{className:"mine-record__header",children:Object(S.jsxs)("div",{className:"mine-record__header__actions",children:[Object(S.jsxs)("div",{className:"mine-record__header__actions__left",children:[Object(S.jsx)(_.a,{checked:t===T.length,onChange:function(t){return e(t.target.checked,"all")}}),Object(S.jsxs)("span",{className:"mine-record__header__actions__left__desc",children:["\u5df2\u9009\u62e9",t,"\u6761"]}),Object(S.jsx)(h.c,{type:"vertical"}),Object(S.jsxs)("div",{className:"mine-record__header__actions__left__delete",onClick:W,children:[Object(S.jsx)(h.d,{name:"trash",fontSize:20}),Object(S.jsx)("span",{className:"mine-record__header__actions__left__desc",children:"\u5220\u9664"})]})]}),Object(S.jsx)("div",{className:"mine-record__header__actions__cancel",onClick:function(){return e(!1,"cancel")},children:"\u9000\u51fa"})]})}):null,Object(S.jsx)(h.g,{id:"mine-record-track",className:"mine-record__list",emptyText:"\u6682\u65e0\u4f5c\u56fe\u8bb0\u5f55\uff0c\u5feb\u53bb\u5f00\u59cb\u4f60\u7684\u8bbe\u8ba1\u5427",loading:c,hasMore:i,dataSource:T,nextPageRequest:z,isWaterfall:!0,getItemHeight:function(e){return e.preview?108*+e.height/+e.width:108},renderItem:function(e){return Object(S.jsx)("div",{className:"mine-record__item",onClick:function(){return U(e)},"data-type":"track","data-track-id":e.id,"data-track-index":e.trackIndex,children:Object(S.jsxs)("div",{style:{height:e.preview?108/+e.width*+e.height:"auto"},children:[Object(S.jsx)("img",{src:Object(R.q)((t=e.preview)&&(t=t.split("!"),c=(t=Object(a.a)(t,2))[0],t[1],c),320),alt:"img"}),Object(S.jsx)("div",{className:m()("mine-record__item__operatePanel",{"mine-record__item__operatePanel--active":!!K[e.id]},{show:Object.values(K).some((function(e){return e}))}),children:Object(S.jsx)(_.a,{className:"mine-record__item__checkbox",checked:!!K[e.id],onClick:function(e){return e.stopPropagation()},onChange:function(t){return c=t,n=e,M((function(e){return Object(b.a)(Object(b.a)({},e),{},Object(l.a)({},n.id,c.target.checked))})),void(c.target.checked?window._stat_track("hb_record_subfunction_click",{"\u5206\u7c7b":"\u52fe\u9009","\u6a21\u7248":n.id}):window._stat_track("hb_record_subfunction_click",{"\u5206\u7c7b":"\u53bb\u9009"}));var c,n}})})]})},e.id);var t,c}})]})}c.r(t);var a=c(8),r=c(0),i=c.n(r),s=c(63),o=c.n(s),d=c(581),u=c(1226),_=(c(525),c(232)),l=c(3),b=c(5),j=c(16),f=c(4),O=c(11),h=c(13),p=c(348),m=(s=c(9),c.n(s)),w=c(89),k=c(177),x=(c(1260),c(1204)),v=c(107),g=c(45),y=c(154),I=c(10),N=c(108),C=c(350),R=c(23),E=c(18),S=c(1),T=(c(1261),c(386)),D=c(282),K=c(43),M=o.a.parse(window.location.search);t.default=i.a.memo((function(){var e=Object(r.useState)(M.type===d.a.TYPE_RECORD?D.a.RECORD:D.a.MATERIAL),t=(e=Object(a.a)(e,2))[0],c=e[1],i=Object(E.c)((function(e){return e.templateModel.isInit})),s=Object(T.a)().currrentMineTab,o=Object(T.b)(),_=Object(K.h)().id;Object(r.useEffect)((function(){c(i?s:D.a.RECORD)}),[s]),e=[{name:"\u6211\u7684\u7d20\u6750",tabKey:"material",content:Object(S.jsx)(u.a,{}),disabled:!i},{name:"\u4f5c\u56fe\u8bb0\u5f55",tabKey:"record",content:Object(S.jsx)(n,{})}];return Object(S.jsxs)("div",{className:"app-slide-content app-slide-mine",children:[Object(S.jsx)("div",{className:"app-slide-mine__header",children:Object(S.jsx)(h.u,{data:e,tabsWidth:"228px",tabsHeight:"26px",handleTabClick:function(e){e!==t&&(c(e),o(e),e===D.a.RECORD?(window._stat_track("hb_record_click"),window._stat_track("tpbj_subfunction_click",{record:_,func_id:"16_71"})):(window._stat_track("hb_myicon_click",{"\u5206\u7c7b":"\u6211\u7684tab"}),window._stat_track("tpbj_subfunction_click",{record:_,func_id:"16_70"})))},showContent:!1,activeIndex:t===D.a.RECORD?2:1})}),Object(S.jsx)("div",{className:"app-slide-mine__body",children:t===D.a.MATERIAL?Object(S.jsx)(u.a,{source:"0"}):Object(S.jsx)(n,{})})]})}))}}]);